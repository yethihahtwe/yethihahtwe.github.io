class a extends Error{type="AstroUserError";hint;name="AstroUserError";constructor(t,e){super(),this.message=t,this.hint=e}static is(t){return t.type==="AstroUserError"}}class l{LETTER_FADE_DURATION=[2,7];baseCanvas;overlayCanvas;baseCtx;overlayCtx;width=document.body.clientWidth;height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.offsetHeight);letterPositions=[];letterInstances=[];primaryRgb;constructor(t,e){const s=t.getContext("2d"),n=e.getContext("2d");if(!s||!n)throw new a("Unable to get 2D context.");this.baseCanvas=t,this.overlayCanvas=e,this.baseCtx=s,this.overlayCtx=n,t.width=this.width,t.height=this.height,e.width=this.width,e.height=this.height,this.primaryRgb=window.getComputedStyle(document.documentElement).getPropertyValue("--primary-rgb").trim(),this.initBackground(),requestAnimationFrame(this.redrawBackground)}initBackground=()=>{let t=document.title.toLowerCase().split(" | ")[0].replace(/\s/g,"_")||"spectre";t.includes("_")&&(t+="_");const e=Math.ceil(this.width/17),s=Math.ceil(this.height/35);for(let o=0;o<s;o++)for(let i=0;i<e;i++)this.baseCtx.font="28px Geist Mono",this.baseCtx.textAlign="start",this.baseCtx.textBaseline="top",this.baseCtx.fillStyle="rgba(255, 255, 255, 0.01)",this.baseCtx.fillText(t[i%t.length],i*17,o*35),this.letterPositions.push({x:i*17,y:o*35,letter:t[i%t.length]});const n=this.getRandomAmountFromArray(this.letterPositions,Number.parseInt((s*.75).toFixed()));for(const o of n){this.overlayCtx.font="bold 28px Geist Mono",this.overlayCtx.textAlign="start",this.overlayCtx.textBaseline="top",this.overlayCtx.fillStyle=`rgba(${this.primaryRgb}, 0)`,this.overlayCtx.shadowBlur=16,this.overlayCtx.shadowColor=`rgba(${this.primaryRgb}, 0)`,this.overlayCtx.fillText(o.letter,o.x,o.y);const i=this.LETTER_FADE_DURATION[0]+Math.random()*(this.LETTER_FADE_DURATION[1]-this.LETTER_FADE_DURATION[0]);this.letterInstances.push({x:o.x,y:o.y,letter:o.letter,timestamp:Date.now(),fadeout:Date.now()+i*1e3})}this.baseCanvas.style.opacity="1"};easeInOutSine=(t,e,s)=>{const n=s-e;if(t<e)return 0;if(t>s){const h=(t-s)/(n/2);return Math.sin(h*Math.PI)}const o=(t-e)/n;return Math.max(0,.5-.5*Math.cos(o*Math.PI))};getRandomAmountFromArray=(t,e=20)=>{let s=t.length;const n=new Array(e),o=new Array(s);if(e>s)throw new a("getRandomAmountFromArray: more elements taken than available");for(;e--;){const i=Math.floor(Math.random()*s);n[e]=t[i in o?o[i]:i],o[i]=--s in o?o[s]:s}return n};redrawBackground=()=>{this.overlayCtx.clearRect(0,0,this.overlayCanvas.width,this.overlayCanvas.height);for(const t of this.letterInstances){if(t.fadeout>Date.now())continue;const e=this.easeInOutSine(Date.now(),t.timestamp,t.fadeout);if(e<=0&&Date.now()>t.fadeout){this.letterInstances.splice(this.letterInstances.indexOf(t),1);const s=this.getRandomAmountFromArray(this.letterPositions,1);this.letterInstances.push({x:s[0].x,y:s[0].y,letter:s[0].letter,timestamp:Date.now(),fadeout:Date.now()+(this.LETTER_FADE_DURATION[0]+Math.random()*(this.LETTER_FADE_DURATION[1]-this.LETTER_FADE_DURATION[0]))*1e3})}this.overlayCtx.font="bold 28px Geist Mono",this.overlayCtx.textAlign="start",this.overlayCtx.textBaseline="top",this.overlayCtx.fillStyle=`rgba(${this.primaryRgb}, ${e})`,this.overlayCtx.shadowBlur=16,this.overlayCtx.shadowColor=`rgba(${this.primaryRgb}, ${e})`,this.overlayCtx.fillText(t.letter,t.x,t.y)}requestAnimationFrame(this.redrawBackground)};resizeBackground=()=>{this.width=document.body.clientWidth,this.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.offsetHeight),this.baseCanvas.width=this.width,this.baseCanvas.height=this.height,this.overlayCanvas.width=this.width,this.overlayCanvas.height=this.height,this.baseCtx.clearRect(0,0,this.baseCanvas.width,this.baseCanvas.height),this.overlayCtx.clearRect(0,0,this.overlayCanvas.width,this.overlayCanvas.height),this.letterInstances=[],this.letterPositions=[],this.initBackground()}}async function c(){const r=new FontFace("Geist Mono","url(/fonts/GeistMono.woff2)");await r.load(),document.fonts.add(r)}async function d(){await c();const r=document.getElementById("bg-canvas"),t=document.getElementById("overlay-canvas"),e=new l(r,t);window.addEventListener("resize",()=>{e.resizeBackground()}),new ResizeObserver(()=>{e.resizeBackground()}).observe(document.body)}d();
